MySQL [lock_test]> source q2
--------------
select  t.thread_id as thread_id
  , t.processlist_id as pid
  , t.PROCESSLIST_DB as db
  , t.PROCESSLIST_COMMAND as psql
  , t.PROCESSLIST_STATE as pstate
  , t.PROCESSLIST_INFO as info
  , t.PROCESSLIST_TIME as ptime
  , ' blocked by thread '
  , dlw.BLOCKING_THREAD_ID as blocking_thread_id
  , group_concat(ml.lock_type) as lock_type
from performance_schema.metadata_locks ml
  join performance_schema.threads t on (t.thread_id = ml.owner_thread_id)
  join performance_schema.processlist p on (p.id = t.processlist_id)
  left join performance_schema.data_lock_waits  dlw on (dlw.REQUESTING_THREAD_ID = t.thread_id)

where ml.lock_type in ('INTENTION_EXCLUSIVE', 'SHARED_WRITE', 'SHARED_UPGRADABLE', 'EXCLUSIVE')
group by thread_id, pid, db, psql, pstate, info, time, ' blocked by thread ', dlw.BLOCKING_THREAD_ID
--------------

+-----------+------+-----------+-------+---------------------------------+------------------------------------------------+-------+---------------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------+
| thread_id | pid  | db        | psql  | pstate                          | info                                           | ptime | blocked by thread   | blocking_thread_id | lock_type                                                                                                                                 |
+-----------+------+-----------+-------+---------------------------------+------------------------------------------------+-------+---------------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------+
|        60 |   24 | lock_test | Sleep | NULL                            | NULL                                           |  1504 |  blocked by thread  |               NULL | SHARED_WRITE                                                                                                                              |
|        64 |   28 | lock_test | Query | updating                        | update locks set i = 4 where i = 1             |  1501 |  blocked by thread  |                 60 | INTENTION_EXCLUSIVE,SHARED_WRITE                                                                                                          |
|        65 |   29 | lock_test | Query | update                          | insert into locks values (2)                   |  1490 |  blocked by thread  |                 60 | INTENTION_EXCLUSIVE,SHARED_WRITE                                                                                                          |
|        67 |   31 | lock_test | Query | update                          | insert into locks values (4)                   |  1488 |  blocked by thread  |                 60 | INTENTION_EXCLUSIVE,SHARED_WRITE                                                                                                          |
|        68 |   32 | lock_test | Query | Waiting for table metadata lock | alter table locks add column (text varchar(1)) |  1485 |  blocked by thread  |               NULL | INTENTION_EXCLUSIVE,INTENTION_EXCLUSIVE,INTENTION_EXCLUSIVE,SHARED_UPGRADABLE,INTENTION_EXCLUSIVE,INTENTION_EXCLUSIVE,EXCLUSIVE,EXCLUSIVE |
+-----------+------+-----------+-------+---------------------------------+------------------------------------------------+-------+---------------------+--------------------+-------------------------------------------------------------------------------------------------------------------------------------------+
5 rows in set, 2 warnings (0.001 sec)

